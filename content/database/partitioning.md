+++
title = 'Partitioning'
date = 2024-11-11T21:17:46+09:00
draft = true
+++

## 파티셔닝

파티셔닝은 DB의 관리 용이성 및 읽기 최적화를 위해 논리적인 테이블의 **물리 구조**를 여러 개의 파티션으로 분할하여 분산 저장하는 기법이다.

파티셔닝을 이용하여 데이터를 조회하게 되면, 조건부 검색을 진행할 때 Lock을 획득하고 있는 시간을 줄여 동시성 저하를 방지하거나, 테이블 크기에 구애받지 않는 성능을 보일 수 있다.

파티셔닝을 사용하는 경우 사용자에게 논리적으로 보여지는 테이블은 하나지만 기저에 물리적으로는 여러 파티션에 데이터를 나누어 저장하게 된다.

이렇게 특정 기준을 기반으로 데이터를 물리적으로 나누어 적재해두면 조건부 작업 시 조건에 부합하는 데이터들에 대해서만 작업을 수행하기 때문에 [Multi block IO](./db-block-io.md) 등에서 이점을 가져오며 인덱스를 통한 조회보다 성능을 높게 가져갈 수도 있다.

**즉, 파티셔닝은 대용량의 논리적 구조를 여러 물리적인 파티션으로 분할하여 조회 및 관리 용이성을 높인다.**

### 파티셔닝 종류

파티셔닝은 크게 수직적 파티셔닝,수평적 파티셔닝으로 나뉜다.

수평적 파티셔닝의 경우 특정 데이터에 대하여 데이터를 일정 기준을 가지고 구분하고, 구분된 번들을 각각 물리적으로 다른 파티션에 적재하는 것을 말한다. 앞서 언급한 내용과 동일하다.

각 파티션이 동일한 구조를 가지기 때문에, 주로 테이블의 크기가 커질 때 **조회 성능을 높이거나 데이터베이스 확장성**을 위해 사용하게 된다.

반면 수직적 파티셔닝은 특정 컬럼을 기준으로 데이터를 분할하는 방법을 말한다. PK가 되는 칼럽을 제외한 다른 칼럼들을 분리하여 적재하는 경우가 해당된다.

수직적 파티셔닝의 경우 한쪽 세그먼트에서 발생하는 DML이 다른쪽에 영향을 끼치지 않는다는 것이다.
반면, 레코드 전체 데이터를 읽어야하는 경우에는 데이터가 물리적으로 분산되어있으므로 IO에서 다소 비효율이 발생할 수 있다.

특정 열에만 접근하는 경우에는 성능을 최적화할 수 있으며, 보안상의 이유로 특정 열을 분리하여 **접근 권한을 다르게 가져가야 하는 경우 사용**할 수 있다.

만일 전체 레코드 전체를 읽어야하는 경우가 잦다면 사용을 다시 한 번 고려해보자...

### 샤딩

샤딩은 NoSQL 제품군에서 주로 언급되는 개념으로 (사실 어디나,,), 수평적 파티셔닝의 한 갈래이다.
파티셔닝은 단일 DBMS 내에서의 데이터 분할 정책이고, 샤딩은 분할된 여러 데이터베이스 서버로 데이터를 분할하는 방법이다.

샤딩을 구성하게 되면 샤드 수만큼 노드가 증가하게 되며, 각 노드에게 분하를 적절히 분산할 수 있다는 것이 장점으로 다가온다.

### 파티셔닝 전략

여러 파티셔닝 전략 중 수평적 파티션닝 전략으로 대표적으로 Range, List, Hash, Key 파티셔닝이 존재한다.

1. Range 파티셔닝: 연속적인 범위를 기반으로 데이터를 분할한다. 날짜나 ID등의 값이 이에 해당할 수 있다.
2. List 파티셔닝: 특정 값 목록에 따라 데이터를 분할한다. 국가나 지역과 같은 열 데이터를 기준으로 특정 국가 목록에 맞춰 데이터를 나눈다.
3. Hash 파티셔닝: 해시 함수를 기반으로 데이터를 분할한다. Hash 함수의 로직도 중요하게 다가올 듯하다.
4. Key 파티셔닝: 특정 키에 따라 데이터를 분할한다. 주로 PK를 사용해 데이터를 분할한다.

앞서 언급한 수평적 파티셔닝의 경우 특정 데이터를 기준을 가지고 나눈뒤, 각각의 데이터 번들을 다른 물리 공간에 저장한다고 하였다. 이때 특정 범위를 기준으로 데이터를 분할한 파티션을 Range 파티션이라고 한다.

Range 파티셔닝의 경우 논리적인 범위의 분산에 효율적으로 동작한다. 또한, 원하는 데이터가 특정 파티션에 집중되어있어 관리에 용이하다.

그러나 Range 파티셔닝의 경우 기준의 특성에 따라 데이터 분포도가 고르지 못할 수 있다는 점이 있다.