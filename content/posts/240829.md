+++
title = '240829'
date = 2024-08-29T11:44:23+09:00
draft = false 
+++

## Caddy with multiple tls configuration

커스텀 도메인 서비스를 제공하는 방법을 고민했다.

1. Google Cloud SSL Management	

하나의 부하 분산기 안에 여러 단위의 대상 프록시를 두는데, 하나의 대상 프록시마다 총 14개의 인증서를 연결할 수 있다. Google Cloud 자체적으로 CA기능을 하기 때문에 별도의 검증이 이루어지지 않더라도 우선적인 인증서 발급이 가능한 구조인 것 같다. 이에 미리 인증서를 발급 및 대상 프록시에 등록해둔 뒤, 해당 레코드를 추후에 추가하는 방식으로도 구현이 가능하다. 이후 인증서 주기 관리까지 진행해준다.

2. AWS ACM

가장 익숙하면서 많이 쓰는 서비스이다. 이메일 혹은 DNS 레코드 기반 검증을 통해 인증서를 발급해주지만, 앞서 언급한 Google Cloud SSL Management보다는 유연성은 떨어지는 듯하다.

3. Caddy

Caddy 는 경량 리버스 프록시로, 내부적으로 Let's Encrypt를 사용해서 자체 인증서 관리를 진행하고, 트래픽을 전달하는 역할을 한다. 
EC2 user data를 통해서 편하게 설정해두고 커스텀 도메인 서비스를 서빙할 수 있었다.
Let's Encrypt...를 사용하는 점이 꺼려진다면 다른 서비스를 연계해서 사용할 수 있다.

### 커스텀 도메인 서비스 제공 완료

아마도 우피와 비슷한 방식일 것 같다. Caddy를 적극 활용했고, 리버스 프록시용 서버는 부하를 고민할 정도는 아닌 것 같아 다행이다(처리할 내용이 많지 않고 빨라 부하가 거의 없는 편). 안정적이면서도 간결한 것 같아 다행이다. 이제 TLS 그만..
지금의 팜스는 정말 좋은 서비스가 된 것 같다.

구축된 내용과 자동화된 스크립트 등을 잘 정리해두자. 시간이 나면 다른 인증 방법을 택할지도!!
오랜만에 작업한 마지막 티켓 완료...팜스 영업 재밌게 뛰기를 바랍니다.