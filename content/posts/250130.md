+++
title = '250130'
date = 2025-01-30T22:47:30+09:00
draft = false
+++

웹 스크래핑을 하는 친구를 어떻게 어떻게 띄울까를 한참 고민하다가,
puppeteer를 사용하려면 무조건 chrome 실행파일이 함께 있어야해서 도커로 한 번에 말아서 여기저기 옮겨다니기에는 조금 용량이 부담되는 이슈가 있었다.

그래서 cheerio를 사용했고, 무리없이 동작하는 것을 확인할 수 있어 이를 가볍게 배포했다.

이후 트래픽을 보내는 과정에서, cloud run 코드 내에서 내가 놓치고 있던 것들은 다음과 같았다. 자주 놓치는데, 기록을 해두자.

1. 배포 실패

eslint 설정 때문에 자꾸 실패한다. 그냥 unused import를 허용하도록 바꾸면 될 일이지만, 마이너한 것이니 그냥 두고 있다..

2. 비동기 제어

nodejs에서는 for loop 내에서의 비동기 로직 수행에 대한 동작이 문법별로 상이하다. 예전에 처음 인턴으로 가서 지도 관련 상태들을 관리하면서 된통 당했던 이슈였던 것 같은데, 오랜만에 쓰는 TS라도 이제는 크게 무리 없이 넘어갈 수 있다. 그때 도와준 희준이에게 감사해야할지도.

이외에는 뭐...큰 무리가 없다. 로깅을 더 세심하게 하자??

그리고 비동기 처리를 제대로 기다리도록 해두니까 스프레드 시트 app scripts 측에서도 이를 올바르게 기다린다. 이제 동기화 완료 버튼이 실제 데이터의 올바른 동기화를 보장할 수 있게 되었다.
