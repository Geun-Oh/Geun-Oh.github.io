+++
title = 'Database 1'
date = 2024-08-30T16:53:28+09:00
draft = true
+++

> 데이터베이스 수강하기 전에 공부해두기
>
> 알고 있는 사항
>
> 1. SQLD자격증을 취득한 정도의 SQL 문법 이해도
> 2. 트랜잭션, ACID, 트랜잭션 격리 수준 등
>
> 공부할 사항
>
> 1. 데이터베이스 엔진을 만들기 위해서 필요한 것들
> 2. 데이터베이스 엔진 구축하기

### 메모리와 디스크 간의 데이터 관리

데이터베이스 시스템은 일반적으로 메모리 (RAM)과 디스크 (HDD/SSD)를 함께 사용하여 데이터 관리.
    - 메모리: 고속 액세스가 필요한 임시 데이터를 저장함. 예를 들어, 자주 액세스되는 데이터 페이지를 메모리에 캐싱하여 데이터베이스의 응답을 높이는 등의 처리 가능.
    - 디스크: 영구 데이터 저장에 사용. 디스크에 저장된 데이터는 시스템이 재시작되어도 유지.

### 데이터 저장 구조

데이터베이스는 데이터를 디스크에 효율적으로 저장하기 위해 특별한 구조 사용. 이를 주로 **페이지**와 **블록**의 단위로 나눈다.

    - 페이지: 한 페이지 당 4KB~16KB 정도 되는 고정 크기의 블록을 의미함. 페이지는 데이터의 기본 단위로 사용되며, 메모리와 디스크 간의 데이터 전송 또한 페이지 단위로 이루어진다.
    - 블록: 디스크에서 데이터를 저장하는 물리적 단위. 데이터베이스는 디스크 블록과 데이터베이스 페이지를 매핑해 데이터 관리.

### 데이터의 논리적 저장 구조

관계형 데이터베이스에서는 데이터를 **테이블**의 형태로 저장함. 테이블은 **행**과 **열**로 구성됨.

### 데이터 저장 방식

데이터베이스에서 데이터를 저장하는 방식은 데이터베이스 엔진 설계에 따라 달라짐. 일반적으로 두 개의 방식을 사용.

1. 행 기반 저장(Row-oriented Storage)
    - 모든 열의 데이터를 각 행에 연속적으로 저장한다.
    - 모든 열을 포함한 개별 행에 대한 액세스가 빠르다. 특정 행의 모든 데이터를 한 번에 가져와야하는 경우 유용하다.
    - 전통적인 관계형 데이터베이스 시스템의 경우 행 기반이다(MySQL, PostgreSQL 등).

예시

```plaintext
| ID | Name   | Age |
|----|--------|-----|
| 1  | Alice  | 30  |
| 2  | Bob    | 25  |
| 3  | Charlie| 35  |
```

위 경우, 데이터는 디스크에 다음과 같이 저장된다. 
`[1, Alice, 30], [2, Bob, 25], [3, Charlie, 35]`

2. 열 기반 저장(Column-oriented Storage)
    - 동일한 열의 모든 데이터를 연속적으로 저장한다.
    - 특정 열의 데이터를 빠르게 접근할 수 있어 분석 작업이나 집계 쿼리 등에서 효율적이다.
    - 분석용 데이터베이스 시스템은 열 기반 저장 방식을 사용한다(Cassandra, Parquet 등).

위와 동일한 예시에서, 데이터는 디스크에 다음과 같이 저장된다. 
`[1, 2, 3], [Alice, Bob, Charlie], [30, 25, 35]`

### 메모리 할당 및 데이터 저장

데이터베이스가 데이터를 특정 경로의 메모리 공간에 할당하고 데이터를 저장하는 과정은 다음과 같다.

1. **디스크 페이지 할당**: 데이터베이스는 데이터를 저장할 공간을 디스크에 페이지 단위로 할당한다. 이때 페이지는 특정 크기의 메모리 블록을 나타낸다.

2. **메모리 버퍼 관리**: 데이터베이스는 메모리 내에서 데이터를 관리하기 위해 버퍼 풀을 사용한다. 버퍼 풀은 자주 사용되는 데이터 페이지를 메모리에 캐싱하여 디스크 접근을 최소화한다.

3. **데이터 쓰기 및 읽기**:

- 쓰기: 세로운 데이터를 삽입하거나 기존 데이터를 업데이트할 때, 데이터는 메모리에 먼저 기록된 후(Buffer Flush) 주기적으로 디스크에 기록된다.

- 읽기: 데이터베이스는 필요한 데이터 페이지를 버퍼 풀에서 찾고, 없다면 디스크에서 페이지를 읽어온다. 이 페이지의 경우 메모리에 캐싱되어 이후 접근 속도를 높인다.

4. **파일 포맷 및 인덱스**: 데이터베이스는 데이터를 저장할 때 효율적인 검색을 위해 인덱스를 함께 관리한다. 인덱스는 데이터의 특정 열을 기준으로 정렬된 정보로, 데이터를 빠르게 검색하는 데 사용한다.

---

이외에도, 데이터베이스는 여러 저장 방식을 지원한다.

1. 하이브리드 저장방식

하이브리드 저장방식은 행 기반과 열 기반 저장 방식을 합친 접근방식이다. 데이터의 일부는 행 기반으로, 다른 일부는 열 기반으로 저장하여 각 방식의 장점을 취했다.

SAP HANA, MemSQL 등이 그 예시.

장점

- 트랜잭션 처리(OLTP)와 분석 처리(OLAP)를 한 시스템에서 최적화가 가능하다.
- 데이터 접근 패턴에 따라 유연하게 저장방식 선택이 가능하다.

2. LSM-트리(Log-Structured Merge-Tree) 저장방식

주로 쓰기 성능 최적화에 중점을 둔다. 새로운 데이터를 메모리에 쓰고, 일정 조건이 충족되면 데이터를 디스크로 병합하여 저장한다.

Cassandra, RocksDB, LevelDB등이 그 예시.

장점

- 쓰기 작업이 빠르고, 쓰기 부하가 높은 애플리케이션에 적합하다.
- 데이터의 삭제 및 업데이트가 빈번하지 않은 워크로드에 유리하다.
- 효율적인 디스크 공간 활용이 가능함.


이외에도 객체 저장(Object Storage), 문서 저장(Document Storage), 그래프 저장(Graph Storage) 등이 존재한다. 나머지는 각자.